# 第九章 一致性和共识

分布式系统容易产生各种各样的错误，最简单的方法就是让系统报错，然后重启。不过很多时候这个方法不可接受。此时就需要有容错性, 容错性实现的方式是找到一些解决错误的抽象方法，比如原子性，孤立性，持久性等。本章的主要抽象是**共识(consensus)**。

达到共识的方法非常有用，可以解决诸如`选出新leader`之类的问题。我们还需要明白什么时候系统可以处理错误然后继续工作下去，什么时候我们不得不停下解决当前的问题。

## 一致性保证

因为不同节点接到写数据的请求的时间不一样，所以数据的不一致不可避免。大多数的数据库都采用**逐渐一致性(eventual consistency)**的方法。但是这种一致性非常脆弱，它没有规定达到一致性所需要的时间。本章节会说一些实现更强的一致性的方法，不过他们会在性能或者容错上有些问题。

## 线性一致性

**线性一致性(Linearizability)**，又叫**原子一致性(atmoic consistency)**，**强一致性(strong consistency)**，**立刻一致性(immediate consistency)**

### 什么使得系统线性
在一个线性性的系统里面，如果我们写了一个值，那么存在某个时刻（写请求发送，到写请求结果返回之间）前我们读到的值永远是旧值，而此时刻之后读到的值永远是新值。测量系统线性度的方法是：将请求排序，看他们是否存在依次顺序。

> 线性一致性和串行化
> 两者都有将物品排列的意思，所以容易混淆。两者的区别在于：
> - 串行化是一种事物孤立属性，事物会同事读写多个对象。串行化保证了事物处理是有序处理的。但是不保证不同节点上数据同时变化。
> - 线性性：是读写单个寄存器的性质,它保证了多个节点上数据同时变化，但是不保证多次执行形成一个序列。它也不会阻写偏斜这样的事物处理错误发生。

